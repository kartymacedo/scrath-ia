javascript:(function(){const config={apiUrl:'https://api.groq.com/openai/v1/chat/completions',model:'llama-3.1-70b-versatile'};const scratchBlocks={motion:['move {} steps','turn right {} degrees','turn left {} degrees','go to x: {} y: {}','go to {}','glide {} secs to x: {} y: {}','point in direction {}','point towards {}','change x by {}','set x to {}','change y by {}','set y to {}','if on edge, bounce','set rotation style {}','x position','y position','direction'],looks:['say {} for {} seconds','say {}','think {} for {} seconds','think {}','switch costume to {}','next costume','switch backdrop to {}','next backdrop','change {} effect by {}','set {} effect to {}','clear graphic effects','change size by {}','set size to {}%','show','hide','go to {} layer','go {} {} layers','costume number','costume name','backdrop number','backdrop name','size'],sound:['play sound {} until done','start sound {}','stop all sounds','change {} effect by {}','set {} effect to {}','clear sound effects','change volume by {}','set volume to {}%','volume'],events:['when flag clicked','when {} key pressed','when this sprite clicked','when stage clicked','when backdrop switches to {}','when {} > {}','when I receive {}','broadcast {}','broadcast {} and wait'],control:['wait {} seconds','repeat {}','forever','if {} then','if {} then else','wait until {}','repeat until {}','stop {}','when I start as a clone','create clone of {}','delete this clone'],sensing:['touching {}?','touching color {}?','color {} is touching {}?','distance to {}','ask {} and wait','answer','key {} pressed?','mouse down?','mouse x','mouse y','set drag mode {}','loudness','timer','reset timer','{} of {}','current {}','days since 2000','username'],operators:['{} + {}','{} - {}','{} * {}','{} / {}','pick random {} to {}','{} > {}','{} < {}','{} = {}','{} and {}','{} or {}','not {}','join {} {}','letter {} of {}','length of {}','{} contains {}?','{} mod {}','round {}','{} of {}'],variables:['set {} to {}','change {} by {}','show variable {}','hide variable {}'],lists:['add {} to {}','delete {} of {}','delete all of {}','insert {} at {} of {}','replace item {} of {} with {}','item {} of {}','item # of {} in {}','length of {}','{} contains {}?','show list {}','hide list {}'],myBlocks:['define {} with inputs','call custom block {}']};const styles=`#scratch-ai-modal{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);border-radius:20px;padding:30px;box-shadow:0 20px 60px rgba(0,0,0,0.4);z-index:999999;width:550px;max-width:90vw;max-height:85vh;overflow-y:auto;font-family:'Helvetica Neue',Arial,sans-serif;animation:modalFadeIn 0.3s ease}@keyframes modalFadeIn{from{opacity:0;transform:translate(-50%,-50%) scale(0.9)}to{opacity:1;transform:translate(-50%,-50%) scale(1)}}#scratch-ai-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.8);z-index:999998;backdrop-filter:blur(5px);animation:overlayFadeIn 0.3s ease}@keyframes overlayFadeIn{from{opacity:0}to{opacity:1}}.ai-header{color:white;font-size:28px;font-weight:bold;margin-bottom:20px;text-align:center;text-shadow:2px 2px 4px rgba(0,0,0,0.3);display:flex;align-items:center;justify-content:center;gap:10px}.ai-input-group{margin-bottom:15px}.ai-label{color:white;font-size:14px;margin-bottom:8px;display:block;font-weight:600;text-shadow:1px 1px 2px rgba(0,0,0,0.2)}.ai-input{width:100%;padding:14px;border:2px solid rgba(255,255,255,0.3);border-radius:10px;font-size:14px;box-sizing:border-box;background:rgba(255,255,255,0.95);transition:all 0.3s;outline:none}.ai-input:focus{border-color:rgba(255,255,255,0.8);box-shadow:0 0 15px rgba(255,255,255,0.3);transform:translateY(-2px)}.ai-textarea{min-height:120px;resize:vertical;font-family:inherit;line-height:1.5}.ai-button{background:linear-gradient(135deg,#4CAF50,#45a049);color:white;border:none;padding:14px 30px;border-radius:10px;font-size:16px;font-weight:bold;cursor:pointer;width:100%;margin-top:10px;transition:all 0.3s;box-shadow:0 4px 15px rgba(0,0,0,0.2);position:relative;overflow:hidden}.ai-button:before{content:'';position:absolute;top:50%;left:50%;width:0;height:0;border-radius:50%;background:rgba(255,255,255,0.3);transition:width 0.6s,height 0.6s,top 0.6s,left 0.6s;transform:translate(-50%,-50%)}.ai-button:hover:before{width:300px;height:300px}.ai-button:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(0,0,0,0.3)}.ai-button:active{transform:translateY(0)}.ai-button:disabled{background:linear-gradient(135deg,#cccccc,#999999);cursor:not-allowed;transform:none}.ai-button.secondary{background:linear-gradient(135deg,#2196F3,#1976D2)}.ai-button.danger{background:linear-gradient(135deg,#f44336,#d32f2f)}.ai-close{position:absolute;top:15px;right:15px;background:rgba(255,255,255,0.2);border:2px solid rgba(255,255,255,0.3);color:white;font-size:24px;cursor:pointer;width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;transition:all 0.3s;font-weight:bold}.ai-close:hover{background:rgba(255,255,255,0.4);transform:rotate(90deg);border-color:rgba(255,255,255,0.6)}.ai-chat{background:rgba(255,255,255,0.98);border-radius:12px;padding:20px;max-height:350px;overflow-y:auto;margin-bottom:15px;box-shadow:inset 0 2px 10px rgba(0,0,0,0.1);border:2px solid rgba(255,255,255,0.3)}.ai-chat::-webkit-scrollbar{width:8px}.ai-chat::-webkit-scrollbar-track{background:rgba(0,0,0,0.05);border-radius:10px}.ai-chat::-webkit-scrollbar-thumb{background:rgba(102,126,234,0.5);border-radius:10px}.ai-chat::-webkit-scrollbar-thumb:hover{background:rgba(102,126,234,0.7)}.ai-message{margin-bottom:12px;padding:12px 15px;border-radius:10px;animation:slideIn 0.4s ease;line-height:1.6;box-shadow:0 2px 5px rgba(0,0,0,0.1)}@keyframes slideIn{from{opacity:0;transform:translateX(-20px)}to{opacity:1;transform:translateX(0)}}.ai-message.user{background:linear-gradient(135deg,#e3f2fd,#bbdefb);margin-left:30px;border-left:4px solid #2196F3}.ai-message.assistant{background:linear-gradient(135deg,#f5f5f5,#eeeeee);margin-right:30px;border-left:4px solid #667eea}.ai-message strong{display:block;margin-bottom:8px;color:#555;font-size:13px;text-transform:uppercase;letter-spacing:0.5px}.ai-code-block{background:#282c34;color:#abb2bf;padding:18px;border-radius:10px;margin:12px 0;overflow-x:auto;font-family:'Courier New',Consolas,monospace;font-size:13px;line-height:1.6;box-shadow:0 4px 15px rgba(0,0,0,0.3);border:2px solid #3e4451}.ai-code-block::-webkit-scrollbar{height:8px}.ai-code-block::-webkit-scrollbar-track{background:rgba(0,0,0,0.2);border-radius:10px}.ai-code-block::-webkit-scrollbar-thumb{background:rgba(171,178,191,0.5);border-radius:10px}.ai-status{color:white;text-align:center;padding:12px;border-radius:10px;margin-bottom:15px;font-size:14px;font-weight:600;animation:statusFade 0.3s ease;box-shadow:0 2px 10px rgba(0,0,0,0.2)}@keyframes statusFade{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}.ai-status.error{background:linear-gradient(135deg,rgba(244,67,54,0.9),rgba(211,47,47,0.9))}.ai-status.success{background:linear-gradient(135deg,rgba(76,175,80,0.9),rgba(56,142,60,0.9))}.ai-status.warning{background:linear-gradient(135deg,rgba(255,152,0,0.9),rgba(245,124,0,0.9))}.ai-status.info{background:linear-gradient(135deg,rgba(33,150,243,0.9),rgba(25,118,210,0.9))}.ai-stats{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:15px}.ai-stat-box{background:rgba(255,255,255,0.2);padding:12px;border-radius:10px;text-align:center;border:2px solid rgba(255,255,255,0.3)}.ai-stat-box .label{color:rgba(255,255,255,0.8);font-size:12px;margin-bottom:5px}.ai-stat-box .value{color:white;font-size:20px;font-weight:bold;text-shadow:1px 1px 2px rgba(0,0,0,0.3)}.ai-examples{background:rgba(255,255,255,0.15);padding:15px;border-radius:10px;margin-bottom:15px;border:2px solid rgba(255,255,255,0.25)}.ai-examples-title{color:white;font-weight:bold;margin-bottom:10px;font-size:14px}.ai-example-btn{background:rgba(255,255,255,0.25);color:white;border:1px solid rgba(255,255,255,0.4);padding:8px 12px;border-radius:6px;font-size:12px;cursor:pointer;margin:5px;transition:all 0.3s;display:inline-block}.ai-example-btn:hover{background:rgba(255,255,255,0.4);transform:translateY(-2px);box-shadow:0 3px 10px rgba(0,0,0,0.2)}.ai-copy-btn{position:absolute;top:10px;right:10px;background:rgba(171,178,191,0.3);color:#abb2bf;border:none;padding:6px 12px;border-radius:6px;font-size:11px;cursor:pointer;transition:all 0.3s}.ai-copy-btn:hover{background:rgba(171,178,191,0.5)}`;let conversationHistory=[];let lastGeneratedCode=null;let messageCount=0;let blockCount=0;function createUI(){const existing=document.getElementById('scratch-ai-overlay');if(existing)existing.remove();if(!document.getElementById('scratch-ai-styles')){const styleEl=document.createElement('style');styleEl.id='scratch-ai-styles';styleEl.textContent=styles;document.head.appendChild(styleEl)}const overlay=document.createElement('div');overlay.id='scratch-ai-overlay';overlay.onclick=(e)=>{if(e.target===overlay)overlay.remove()};const modal=document.createElement('div');modal.id='scratch-ai-modal';modal.innerHTML=`<button class="ai-close" title="Fechar">×</button><div class="ai-header"><span>🤖</span><span>Scratch AI Builder Pro</span></div><div class="ai-stats"><div class="ai-stat-box"><div class="label">Mensagens</div><div class="value" id="msg-count">0</div></div><div class="ai-stat-box"><div class="label">Blocos Criados</div><div class="value" id="block-count">0</div></div></div><div class="ai-input-group"><label class="ai-label">🔑 API Key (Groq/OpenAI/etc)</label><input type="password" id="ai-api-key" class="ai-input" placeholder="Cole sua API key aqui (ex: gsk_...)"></div><div class="ai-examples"><div class="ai-examples-title">💡 Exemplos rápidos:</div><button class="ai-example-btn" onclick="document.getElementById('ai-prompt').value='Criar um jogo onde o gato pula quando pressiono espaço e evita obstáculos que vêm da direita'">🎮 Jogo de Pulo</button><button class="ai-example-btn" onclick="document.getElementById('ai-prompt').value='Fazer o sprite seguir o mouse e mudar de cor quando clicado'">🎨 Seguir Mouse</button><button class="ai-example-btn" onclick="document.getElementById('ai-prompt').value='Criar um sistema de pontuação que aumenta quando toco em moedas'">💰 Sistema Pontos</button><button class="ai-example-btn" onclick="document.getElementById('ai-prompt').value='Fazer o personagem andar com as setas do teclado'">⌨️ Controle Teclado</button></div><div id="ai-status-container"></div><div id="ai-chat-container" class="ai-chat" style="display:none;"></div><div class="ai-input-group"><label class="ai-label">💭 Descreva seu projeto Scratch</label><textarea id="ai-prompt" class="ai-input ai-textarea" placeholder="Seja específico! Exemplo: Criar um jogo onde o gato pula obstáculos, com sistema de pontuação e game over quando colide"></textarea></div><button id="ai-generate-btn" class="ai-button">✨ Gerar Código com IA</button><button id="ai-apply-btn" class="ai-button secondary" style="display:none;">📦 Copiar Código JSON</button><button id="ai-clear-btn" class="ai-button danger" style="display:none;">🗑️ Limpar Conversa</button>`;modal.querySelector('.ai-close').onclick=()=>overlay.remove();overlay.appendChild(modal);document.body.appendChild(overlay);document.getElementById('ai-generate-btn').onclick=generateCode;document.getElementById('ai-apply-btn').onclick=copyCode;document.getElementById('ai-clear-btn').onclick=clearConversation}async function generateCode(){const apiKey=document.getElementById('ai-api-key').value.trim();const prompt=document.getElementById('ai-prompt').value.trim();if(!apiKey){showStatus('❌ Insira sua API key primeiro!','error');document.getElementById('ai-api-key').focus();return}if(!prompt){showStatus('❌ Descreva o que você quer criar!','error');document.getElementById('ai-prompt').focus();return}const btn=document.getElementById('ai-generate-btn');btn.disabled=true;btn.textContent='⏳ Gerando código...';const chatContainer=document.getElementById('ai-chat-container');chatContainer.style.display='block';addMessage('user',prompt);messageCount++;updateStats();const systemPrompt=`Você é um especialista em Scratch 3.0 e deve gerar código em formato JSON VÁLIDO e COMPLETO.

BLOCOS DISPONÍVEIS NO SCRATCH:
${JSON.stringify(scratchBlocks,null,2)}

REGRAS IMPORTANTES:
1. Responda APENAS com JSON válido, sem texto adicional antes ou depois
2. Use blocos reais do Scratch listados acima
3. Seja criativo e completo na implementação
4. Inclua todos os sprites necessários
5. Use nomes descritivos para sprites
6. Adicione comentários explicativos
7. Organize os blocos de forma lógica

FORMATO OBRIGATÓRIO:
{
  "project": {
    "name": "Nome do Projeto",
    "description": "Descrição breve"
  },
  "sprites": [
    {
      "name": "NomeSprite",
      "costumes": ["costume1","costume2"],
      "scripts": [
        {
          "trigger": "when flag clicked",
          "blocks": [
            {
              "category": "motion",
              "opcode": "move",
              "params": {"STEPS": 10}
            },
            {
              "category": "control",
              "opcode": "forever",
              "blocks": [
                {
                  "category": "looks",
                  "opcode": "say",
                  "params": {"MESSAGE": "Olá!", "SECS": 2}
                }
              ]
            }
          ]
        }
      ],
      "variables": [{"name": "pontos", "value": 0}],
      "lists": []
    }
  ],
  "stage": {
    "backdrops": ["backdrop1"],
    "scripts": [],
    "variables": [],
    "lists": []
  },
  "explanation": "Explicação detalhada do funcionamento",
  "features": ["recurso1", "recurso2"],
  "instructions": "Como usar o projeto"
}

Seja criativo e implemente tudo o que o usuário pediu de forma completa e funcional!`;conversationHistory.push({role:'user',content:prompt});showStatus('🤖 IA está pensando...','info');try{const response=await fetch(config.apiUrl,{method:'POST',headers:{'Content-Type':'application/json','Authorization':`Bearer ${apiKey}`},body:JSON.stringify({model:config.model,messages:[{role:'system',content:systemPrompt},...conversationHistory],temperature:0.8,max_tokens:4000,top_p:0.95})});if(!response.ok){const errorData=await response.json().catch(()=>({}));throw new Error(`API Error ${response.status}: ${errorData.error?.message||'Erro desconhecido'}`)}const data=await response.json();const assistantMessage=data.choices[0].message.content;conversationHistory.push({role:'assistant',content:assistantMessage});let jsonMatch=assistantMessage.match(/\{[\s\S]*\}/);if(jsonMatch){try{lastGeneratedCode=JSON.parse(jsonMatch[0]);blockCount=countBlocks(lastGeneratedCode);updateStats();const explanation=lastGeneratedCode.explanation||'Código gerado com sucesso!';addMessage('assistant',`✅ **Código gerado!**\n\n${explanation}\n\n**Recursos:** ${(lastGeneratedCode.features||[]).join(', ')}\n\n**Como usar:** ${lastGeneratedCode.instructions||'Clique na bandeira verde para executar'}`);addCodeBlock(JSON.stringify(lastGeneratedCode,null,2));document.getElementById('ai-apply-btn').style.display='block';document.getElementById('ai-clear-btn').style.display='block';showStatus('✅ Código pronto! Copie o JSON e importe no Scratch','success');document.getElementById('ai-prompt').value=''}catch(parseError){addMessage('assistant',assistantMessage);showStatus('⚠️ JSON inválido gerado. Tente novamente','warning')}}else{addMessage('assistant',assistantMessage);showStatus('⚠️ Resposta sem JSON. Reformule sua pergunta','warning')}}catch(error){console.error('Erro:',error);addMessage('assistant',`❌ **Erro:** ${error.message}`);showStatus(`❌ ${error.message}`,'error')}finally{btn.disabled=false;btn.textContent='✨ Gerar Código com IA'}}function countBlocks(code){let count=0;if(code.sprites){code.sprites.forEach(sprite=>{if(sprite.scripts){sprite.scripts.forEach(script=>{count+=countBlocksRecursive(script.blocks||[])})}})}return count}function countBlocksRecursive(blocks){let count=0;blocks.forEach(block=>{count++;if(block.blocks){count+=countBlocksRecursive(block.blocks)}});return count}function copyCode(){if(!lastGeneratedCode){showStatus('❌ Nenhum código para copiar!','error');return}try{const codeText=JSON.stringify(lastGeneratedCode,null,2);navigator.clipboard.writeText(codeText).then(()=>{showStatus('✅ Código copiado! Cole em um editor JSON ou salve em arquivo','success');const btn=document.getElementById('ai-apply-btn');const originalText=btn.textContent;btn.textContent='✓ Copiado!';setTimeout(()=>{btn.textContent=originalText},2000)}).catch(err=>{console.error('Erro ao copiar:',err);const textarea=document.createElement('textarea');textarea.value=codeText;textarea.style.position='fixed';textarea.style.opacity='0';document.body.appendChild(textarea);textarea.select();document.execCommand('copy');document.body.removeChild(textarea);showStatus('✅ Código copiado!','success')})}catch(error){showStatus(`❌ Erro: ${error.message}`,'error')}}function clearConversation(){if(confirm('Deseja limpar toda a conversa e começar do zero?')){conversationHistory=[];lastGeneratedCode=null;messageCount=0;blockCount=0;document.getElementById('ai-chat-container').innerHTML='';document.getElementById('ai-chat-container').style.display='none';document.getElementById('ai-apply-btn').style.display='none';document.getElementById('ai-clear-btn').style.display='none';document.getElementById('ai-prompt').value='';updateStats();showStatus('🔄 Conversa limpa! Comece uma nova','info')}}function addMessage(role,content){const chatContainer=document.getElementById('ai-chat-container');const messageDiv=document.createElement('div');messageDiv.className=`ai-message ${role}`;const roleLabel=role==='user'?'👤 Você':'🤖 IA Assistant';messageDiv.innerHTML=`<strong>${roleLabel}</strong>${content.replace(/\n/g,'<br>').replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>')}`;chatContainer.appendChild(messageDiv);chatContainer.scrollTop=chatContainer.scrollHeight}function addCodeBlock(code){const chatContainer=document.getElementById('ai-chat-container');const codeWrapper=document.createElement('div');codeWrapper.style.position='relative';const copyBtn=document.createElement('button');copyBtn.className='ai-copy-btn';copyBtn.textContent='📋 Copiar';copyBtn.onclick=()=>{navigator.clipboard.writeText(code);copyBtn.textContent='✓ Copiado!';setTimeout(()=>{copyBtn.textContent='📋 Copiar'},2000)};const codeDiv=document.createElement('div');codeDiv.className='ai-code-block';codeDiv.textContent=code;codeWrapper.appendChild(copyBtn);codeWrapper.appendChild(codeDiv);chatContainer.appendChild(codeWrapper);chatContainer.scrollTop=chatContainer.scrollHeight}function showStatus(message,type='info'){const statusContainer=document.getElementById('ai-status-container');statusContainer.innerHTML=`<div class="ai-status ${type}">${message}</div>`;setTimeout(()=>{if(statusContainer.querySelector('.ai-status')){statusContainer.querySelector('.ai-status').style.opacity='0.7'}},3000)}function updateStats(){document.getElementById('msg-count').textContent=messageCount;document.getElementById('block-count').textContent=blockCount}createUI();console.log('%c🚀 Scratch AI Builder Pro Ativado!','font-size:20px;color:#667eea;font-weight:bold;text-shadow:2px 2px 4px rgba(0,0,0,0.3)');console.log('%c💡 Use a interface para criar projetos Scratch com IA!','font-size:14px;color:#764ba2')})();
